/**
 * jQuery.imgLoadCatch.js v0.2.2
 * https://github.com/TevinLi/imgloadcatch
 *
 * Copyright 2015, Tevin Li
 * Released under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 */

!function(a,b,c){"use strict";var d,e=!1;d=function(){return function(b){this.config={total:0,count:0,countIMG:0,countBg:0,imgError:0,bgError:0,state:[!0,!0],queImg:[],queBg:[],disTag:["br","hr","script","code","del","embed","frame","frameset","iframe","link","style","object","pre","video","wbr","xmp"]},this.options=a.extend({deep:"img","export":!0,start:function(){},step:function(){},imgTag:function(){},finish:function(){}},b||{}),this.init()}}(),d.prototype.init=function(){var b,d,e,f,g,h,i,j,k;if(this.options.start(),b=c.body.getElementsByTagName("*"),"img"==this.options.deep){for(d=0,e=b.length;e>d;d++)"img"==b[d].tagName.toLowerCase()&&null===b[d].getAttribute("no-catch")&&(this.config.state[0]=!1,this.config.queImg.push(b[d].src),this.config.total++);this.listenIMG()}else if("all"==this.options.deep){for(f=0,g=b.length;g>f;f++)if(!this.isDisTag(b[f].tagName)&&("input"!=b[f].tagName.toLowerCase()||"radio"!=b[f].type&&"checkbox"!=b[f].type)&&null===b[f].getAttribute("no-catch"))if("img"==b[f].tagName.toLowerCase()&&null===b[f].getAttribute("no-catch"))this.config.state[0]=!1,this.config.queImg.push(b[f].src),this.config.total++;else if(h=this.getBackgroundImage(b[f]),"none"!=h){for(i=!1,j=h.match(/\([^\)]+\)/g)[0].replace(/\(|\)/g,"").replace(/^\s+|\s+$/g,""),k=0;k<this.config.queBg.length;k++)if(j==this.config.queBg[k]){i=!0;break}i||(this.config.state[1]=!1,this.config.queBg.push(j),this.config.total++)}this.listenIMG(),this.listenBg()}},d.prototype.listenIMG=function(){var b,a=this;for(b=0;b<this.config.queImg.length;b++)this.imgLoad(this.config.queImg[b],function(b){a.config.count++,a.config.countIMG++,a.config.imgError+=b?0:1;var c=parseInt(100*(a.config.count/a.config.total));a.options.step(c,a.config.total,a.config.count),a.config.countIMG==a.config.queImg.length&&(a.options.imgTag(),a.config.state[0]=!0,a.end())},"img")},d.prototype.listenBg=function(){var b,a=this;for(b=0;b<this.config.queBg.length;b++)this.imgLoad(this.config.queBg[b],function(b){a.config.count++,a.config.countBg++,a.config.bgError+=b?0:1;var c=parseInt(100*(a.config.count/a.config.total));a.options.step(c,a.config.total,a.config.count),a.config.countBg==a.config.queBg.length&&(a.config.state[1]=!0,a.end())},"bg")},d.prototype.end=function(){var a=this,b=function(){setTimeout(function(){a.options.finish({total:a.config.total,count:a.config.count,countError:a.config.imgError+a.config.bgError,countSuccess:a.config.count-(a.config.imgError+a.config.bgError),imgTag:a.config.countIMG,imgTagError:a.config.imgError,imgTagSuccess:a.config.countIMG-a.config.imgError,cssBg:a.config.countBg,cssBgError:a.config.bgError,cssBgSuccess:a.config.countBg-a.config.bgError})},100)};"img"==this.options.deep?this.config.state[0]&&b():"all"==this.options.deep&&this.config.state[0]&&this.config.state[1]&&(this.config.queBg=[],b())},d.prototype.imgLoad=function(a,b,c){var e,d=new Image;"img"==c?e="<img> src-url":(e="css background-image",a.indexOf('"')>=0&&(a=a.replace(/\"/g,""))),d.onload=function(){b(!0),d.onload=null,d.onerror=null},d.onerror=function(){b(!1),d.onload=null,d.onerror=null;var c="Can't load "+e+': "'+a+'"';throw new Error(c)},d.src=a},d.prototype.isDisTag=function(a){var d,b=a.toLowerCase(),c=!1;for(d=0;d<this.config.disTag.length;d++)if(b==this.config.disTag[d]){c=!0;break}return c},d.prototype.getBackgroundImage=function(a){return c.defaultView&&c.defaultView.getComputedStyle?c.defaultView.getComputedStyle(a,null).backgroundImage:a.currentStyle.backgroundImage},a.extend(a,{imgLoadCatch:function(a){e||(e=!0,new d(a))}})}($,window,document);
